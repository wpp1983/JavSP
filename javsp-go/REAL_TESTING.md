# çœŸå®æµ‹è¯•æŒ‡å— (Real Testing Guide)

è¿™ä¸ªæ–‡æ¡£ä»‹ç»äº†JavSP-Goé¡¹ç›®ä¸­æ–°å¢çš„çœŸå®ç½‘ç«™æµ‹è¯•åŠŸèƒ½ã€‚

## æ¦‚è¿°

é™¤äº†ç°æœ‰çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼ˆä½¿ç”¨Mockæ•°æ®ï¼‰ï¼Œæˆ‘ä»¬æ–°å¢äº†ä»¥ä¸‹çœŸå®æµ‹è¯•ç±»å‹ï¼š

1. **çœŸå®ç½‘ç«™çˆ¬è™«æµ‹è¯•** - å¯¹çœŸå®çš„JavBuså’ŒAVWikiç½‘ç«™è¿›è¡Œæµ‹è¯•
2. **çœŸå®å›¾ç‰‡ä¸‹è½½æµ‹è¯•** - æµ‹è¯•ä»äº’è”ç½‘ä¸‹è½½çœŸå®å›¾ç‰‡
3. **ç½‘ç»œå®¹é”™æµ‹è¯•** - æµ‹è¯•å„ç§ç½‘ç»œæ•…éšœåœºæ™¯çš„å¤„ç†

## æµ‹è¯•å‘½ä»¤

### åŸºæœ¬å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰çœŸå®ç½‘ç«™æµ‹è¯•ï¼ˆéœ€è¦ç½‘ç»œè¿æ¥ï¼‰
make test-real

# è¿è¡Œç½‘ç»œå®¹é”™æµ‹è¯•
make test-network

# è¿è¡ŒåŒ…å«çœŸå®æµ‹è¯•åœ¨å†…çš„æ‰€æœ‰æµ‹è¯•
make test-all

# è¿è¡Œé™¤çœŸå®ç½‘ç«™æµ‹è¯•å¤–çš„æ‰€æœ‰æµ‹è¯•ï¼ˆé€‚åˆCIç¯å¢ƒï¼‰
make test-ci-safe
```

### Goå‘½ä»¤

```bash
# ç›´æ¥ä½¿ç”¨go testè¿è¡ŒçœŸå®æµ‹è¯•
go test -v -tags="integration && real_sites" ./test/integration/...

# åªè¿è¡Œçˆ¬è™«æµ‹è¯•
go test -v -tags="integration && real_sites" -run="TestReal.*Crawler" ./test/integration/...

# åªè¿è¡Œä¸‹è½½æµ‹è¯•
go test -v -tags="integration && real_sites" -run="TestReal.*Download" ./test/integration/...

# åªè¿è¡Œç½‘ç»œå®¹é”™æµ‹è¯•
go test -v -tags="integration && real_sites" -run="TestNetwork.*" ./test/integration/...
```

## æµ‹è¯•ç±»å‹è¯¦è§£

### 1. çœŸå®çˆ¬è™«æµ‹è¯• (`real_crawler_test.go`)

**æµ‹è¯•å†…å®¹ï¼š**
- éªŒè¯JavBuså’ŒAVWikiçˆ¬è™«çš„å¯ç”¨æ€§
- ä½¿ç”¨å·²çŸ¥å­˜åœ¨çš„ç”µå½±IDæµ‹è¯•æ•°æ®æå–
- éªŒè¯HTMLè§£æé€»è¾‘åœ¨çœŸå®é¡µé¢ä¸Šçš„è¡¨ç°
- æ£€æŸ¥æ•°æ®å®Œæ•´æ€§å’Œæ ¼å¼æ­£ç¡®æ€§

**æµ‹è¯•çš„ç”µå½±IDï¼š**
```go
// JavBusæµ‹è¯•ID
"STARS-123", "SSIS-001", "IPX-177", "PRED-456"

// AVWikiæµ‹è¯•ID  
"SSIS-698", "STARS-256", "IPX-001"
```

**éªŒè¯é¡¹ç›®ï¼š**
- åŸºæœ¬å­—æ®µæå–ï¼ˆæ ‡é¢˜ã€å‘å¸ƒæ—¥æœŸã€å¥³ä¼˜ã€ç±»å‹ç­‰ï¼‰
- URLæ ¼å¼éªŒè¯
- HTMLæ ‡ç­¾æ¸…ç†
- æ•°æ®æ ¼å¼æ ‡å‡†åŒ–

### 2. çœŸå®ä¸‹è½½æµ‹è¯• (`real_downloader_test.go`)

**æµ‹è¯•å†…å®¹ï¼š**
- ä¸‹è½½ä¸åŒæ ¼å¼çš„æµ‹è¯•å›¾ç‰‡ï¼ˆJPEGã€PNGã€WebPï¼‰
- æµ‹è¯•å¹¶å‘ä¸‹è½½åŠŸèƒ½
- éªŒè¯è¿›åº¦å›è°ƒæœºåˆ¶
- æµ‹è¯•é”™è¯¯å¤„ç†ï¼ˆ404ã€æœåŠ¡å™¨é”™è¯¯ç­‰ï¼‰
- æµ‹è¯•å¤§æ–‡ä»¶ä¸‹è½½
- éªŒè¯ä¸‹è½½ç»Ÿè®¡åŠŸèƒ½

**æµ‹è¯•URLï¼š**
- `https://httpbin.org/image/jpeg` - å°JPEGå›¾ç‰‡
- `https://httpbin.org/image/png` - å°PNGå›¾ç‰‡
- `https://httpbin.org/image/webp` - å°WebPå›¾ç‰‡

**éªŒè¯é¡¹ç›®ï¼š**
- æ–‡ä»¶æˆåŠŸä¸‹è½½å¹¶ä¿å­˜
- æ–‡ä»¶å¤§å°å’Œå†…å®¹ç±»å‹æ­£ç¡®
- é”™è¯¯æƒ…å†µä¸‹çš„æ¸…ç†å·¥ä½œ
- å¹¶å‘ä¸‹è½½çš„ç¨³å®šæ€§

### 3. ç½‘ç»œå®¹é”™æµ‹è¯• (`network_resilience_test.go`)

**æµ‹è¯•åœºæ™¯ï¼š**

#### DNSæ•…éšœ
- ä½¿ç”¨ä¸å­˜åœ¨çš„åŸŸåæµ‹è¯•DNSè§£æå¤±è´¥
- éªŒè¯é”™è¯¯å¤„ç†å’Œè¶…æ—¶æœºåˆ¶

#### è¿æ¥è¶…æ—¶
- æµ‹è¯•è¿æ¥åˆ°ä¸å“åº”çš„ç«¯å£
- éªŒè¯è¶…æ—¶è®¾ç½®çš„æœ‰æ•ˆæ€§

#### æœåŠ¡å™¨é”™è¯¯
- æµ‹è¯•å„ç§HTTPé”™è¯¯ç ï¼ˆ500ã€502ã€503ã€504ï¼‰
- éªŒè¯é‡è¯•æœºåˆ¶

#### æ…¢é€ŸæœåŠ¡å™¨
- æµ‹è¯•æœåŠ¡å™¨å“åº”ç¼“æ…¢çš„æƒ…å†µ
- éªŒè¯è¶…æ—¶å’Œå–æ¶ˆæœºåˆ¶

#### ç½‘ç»œæ¢å¤
- æµ‹è¯•é—´æ­‡æ€§æ•…éšœçš„æ¢å¤èƒ½åŠ›
- éªŒè¯é‡è¯•åæˆåŠŸçš„åœºæ™¯

## é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®ä»£ç†æµ‹è¯•URLï¼ˆå¯é€‰ï¼‰
export TEST_PROXY_URL="http://proxy.example.com:8080"

# è®¾ç½®æµ‹è¯•è¶…æ—¶ï¼ˆå¯é€‰ï¼‰
export TEST_TIMEOUT="300s"
```

### æµ‹è¯•é…ç½®

çœŸå®æµ‹è¯•ä½¿ç”¨äº†ä»¥ä¸‹é…ç½®ä»¥ç¡®ä¿å¯¹ç›®æ ‡ç½‘ç«™çš„å‹å¥½è®¿é—®ï¼š

```go
// çˆ¬è™«é…ç½®
config := &crawler.CrawlerConfig{
    Timeout:    30 * time.Second,
    MaxRetries: 3,
    RetryDelay: 2 * time.Second,
    RateLimit:  3 * time.Second, // è¯·æ±‚é—´éš”3ç§’
    UserAgent:  "Mozilla/5.0 (compatible; JavSP-Test/1.0)",
}

// ä¸‹è½½å™¨é…ç½®
config := downloader.DefaultDownloadConfig()
config.MaxConcurrency = 3        // æœ€å¤§å¹¶å‘æ•°
config.Timeout = 30 * time.Second
config.MaxFileSize = 10 * 1024 * 1024 // 10MBé™åˆ¶
```

## æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦è­¦å‘Š

1. **ç½‘ç»œä¾èµ–**: çœŸå®æµ‹è¯•éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
2. **å¤–éƒ¨ä¾èµ–**: æµ‹è¯•ä¾èµ–å¤–éƒ¨ç½‘ç«™çš„å¯ç”¨æ€§
3. **æ‰§è¡Œæ—¶é—´**: çœŸå®æµ‹è¯•æ¯”Mockæµ‹è¯•è€—æ—¶æ›´é•¿
4. **é¢‘ç‡é™åˆ¶**: é¿å…é¢‘ç¹è¿è¡Œä»¥å…è¢«ç›®æ ‡ç½‘ç«™é™åˆ¶

### ğŸš« ä¸é€‚åˆçš„åœºæ™¯

- **CI/CDæµæ°´çº¿**: ä½¿ç”¨`make test-ci-safe`ä»£æ›¿
- **ç¦»çº¿ç¯å¢ƒ**: æ— ç½‘ç»œè¿æ¥æ—¶è·³è¿‡
- **å¿«é€Ÿå¼€å‘**: å¼€å‘æ—¶ä¼˜å…ˆä½¿ç”¨å•å…ƒæµ‹è¯•

### âœ… é€‚åˆçš„åœºæ™¯

- **å‘å¸ƒå‰éªŒè¯**: ç¡®ä¿åœ¨çœŸå®ç¯å¢ƒä¸­çš„åŠŸèƒ½æ­£å¸¸
- **ç½‘ç«™å˜æ›´æ£€æµ‹**: åŠæ—¶å‘ç°ç›®æ ‡ç½‘ç«™ç»“æ„å˜åŒ–
- **æ€§èƒ½åŸºå‡†æµ‹è¯•**: åœ¨çœŸå®ç½‘ç»œæ¡ä»¶ä¸‹çš„æ€§èƒ½è¡¨ç°
- **é—®é¢˜æ’æŸ¥**: å¤ç°ç”¨æˆ·æŠ¥å‘Šçš„ç½‘ç»œç›¸å…³é—®é¢˜

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. DNSè§£æå¤±è´¥
```
Error: no such host
```
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒDNSè®¾ç½®

#### 2. è¿æ¥è¶…æ—¶
```
Error: dial tcp: i/o timeout
```
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥é˜²ç«å¢™è®¾ç½®æˆ–å¢åŠ è¶…æ—¶æ—¶é—´

#### 3. 403/429é”™è¯¯
```
Error: HTTP 403/429
```
**è§£å†³æ–¹æ¡ˆ**: é™ä½æµ‹è¯•é¢‘ç‡ï¼Œç­‰å¾…åé‡è¯•

#### 4. è¯ä¹¦é”™è¯¯
```
Error: x509: certificate verify failed
```
**è§£å†³æ–¹æ¡ˆ**: ç½‘ç»œç¯å¢ƒå¯èƒ½æœ‰è¯ä¹¦é—®é¢˜ï¼Œæ£€æŸ¥ä»£ç†è®¾ç½®

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**:
```bash
go test -v -tags="integration && real_sites" ./test/integration/... -args -test.v
```

2. **å•ç‹¬è¿è¡Œæµ‹è¯•**:
```bash
go test -v -tags="integration && real_sites" -run="TestRealJavBusCrawler" ./test/integration/...
```

3. **è®¾ç½®æ›´é•¿è¶…æ—¶**:
```bash
go test -timeout=600s -tags="integration && real_sites" ./test/integration/...
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„çœŸå®æµ‹è¯•

1. **é€‰æ‹©æµ‹è¯•ç±»å‹**: ç¡®å®šæ˜¯çˆ¬è™«ã€ä¸‹è½½è¿˜æ˜¯ç½‘ç»œå®¹é”™æµ‹è¯•
2. **æ·»åŠ æ„å»ºæ ‡ç­¾**: ä½¿ç”¨`//go:build integration && real_sites`
3. **è®¾ç½®åˆç†è¶…æ—¶**: çœŸå®æµ‹è¯•éœ€è¦æ›´é•¿çš„è¶…æ—¶æ—¶é—´
4. **æ·»åŠ é”™è¯¯å¤„ç†**: ç½‘ç»œæµ‹è¯•å¯èƒ½å¤±è´¥ï¼Œéœ€è¦ä¼˜é›…å¤„ç†
5. **è®°å½•æµ‹è¯•æ—¥å¿—**: ä¾¿äºè°ƒè¯•å’Œç›‘æ§

### æµ‹è¯•æ•°æ®é€‰æ‹©

**çˆ¬è™«æµ‹è¯•**:
- é€‰æ‹©çŸ¥åã€ç¨³å®šå­˜åœ¨çš„ç”µå½±ID
- é¿å…ä½¿ç”¨å¯èƒ½è¢«åˆ é™¤çš„æ–°ç”µå½±
- å®šæœŸéªŒè¯æµ‹è¯•æ•°æ®çš„æœ‰æ•ˆæ€§

**ä¸‹è½½æµ‹è¯•**:
- ä½¿ç”¨ç¨³å®šçš„æµ‹è¯•æœåŠ¡ï¼ˆå¦‚httpbin.orgï¼‰
- é€‰æ‹©å°æ–‡ä»¶ä»¥å‡å°‘æµ‹è¯•æ—¶é—´
- é¿å…ä½¿ç”¨å¯èƒ½å˜åŒ–çš„çœŸå®ç½‘ç«™å›¾ç‰‡

## ç›‘æ§å’Œç»´æŠ¤

### å®šæœŸæ£€æŸ¥

1. **æ¯æœˆè¿è¡Œ**: `make test-real` æ£€æŸ¥ç½‘ç«™å…¼å®¹æ€§
2. **æ›´æ–°æµ‹è¯•æ•°æ®**: æ›¿æ¢å¤±æ•ˆçš„æµ‹è¯•ç”µå½±ID
3. **ç›‘æ§æ‰§è¡Œæ—¶é—´**: æ£€æŸ¥ç½‘ç»œæ€§èƒ½å˜åŒ–
4. **å®¡æŸ¥æ—¥å¿—**: æŸ¥æ‰¾æ½œåœ¨çš„å…¼å®¹æ€§é—®é¢˜

### æµ‹è¯•ç»“æœåˆ†æ

```bash
# è¿è¡Œæµ‹è¯•å¹¶ä¿å­˜è¯¦ç»†æ—¥å¿—
make test-real 2>&1 | tee real-test-results.log

# åˆ†ææˆåŠŸç‡
grep -c "PASS\|FAIL" real-test-results.log

# æŸ¥çœ‹é”™è¯¯æ¨¡å¼  
grep "Error\|Failed" real-test-results.log
```

---

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ
**ç»´æŠ¤è€…**: JavSPå›¢é˜Ÿ